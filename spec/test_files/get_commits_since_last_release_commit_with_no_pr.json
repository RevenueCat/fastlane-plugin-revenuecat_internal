{
  "url": "https://api.github.com/repos/RevenueCat/purchases-ios/compare/1.11.0...HEAD",
  "html_url": "https://github.com/RevenueCat/purchases-ios/compare/1.11.0...HEAD",
  "permalink_url": "https://github.com/RevenueCat/purchases-ios/compare/RevenueCat:70365df...RevenueCat:4ceaceb",
  "diff_url": "https://github.com/RevenueCat/purchases-ios/compare/1.11.0...HEAD.diff",
  "patch_url": "https://github.com/RevenueCat/purchases-ios/compare/1.11.0...HEAD.patch",
  "base_commit": {
    "sha": "70365df383180d0225a8ff3df05444275bad3c4e",
    "node_id": "C_kwDOBnB8hdoAKDcwMzY1ZGYzODMxODBkMDIyNWE4ZmYzZGYwNTQ0NDI3NWJhZDNjNGU",
    "commit": {
      "author": {
        "name": "NachoSoto",
        "email": "NachoSoto@users.noreply.github.com",
        "date": "2022-10-11T20:38:54Z"
      },
      "committer": {
        "name": "GitHub",
        "email": "noreply@github.com",
        "date": "2022-10-11T20:38:54Z"
      },
      "message": "Purchasing: fixed consumable purchases by fixing transaction-finishing (#1965)\n\nFixes #1964, [TRIAGE-134], [TRIAGE-131], and possibly [TRIAGE-82].\r\n\r\nDepends on #1967, #1968.\r\n\r\n### Fixes:\r\n- For `SK2` purchases we were never finishing transactions. We are now.\r\n- For `SK1` purchases, transactions were finished _after_ the completion\r\nblock was invoked (and tests were very lenient checking that\r\n_eventually_ this happened). This could have lead to race conditions.\r\n- For SK2 only (at least in `SKTestSession`s), this fixes the ability to\r\npurchase multiple consumable purchases.\r\n\r\nThis is the log from the failing test using SK2:\r\n<details>\r\n  <summary>Open</summary>\r\n\r\n```\r\n2022-10-06 15:18:52.286813-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: GET /v1/subscribers/$RCAnonymousID:6f630d50b8294288a2d0862629d766fb/offerings\r\n2022-10-06 15:18:52.383594-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: GET /v1/subscribers/$RCAnonymousID:6f630d50b8294288a2d0862629d766fb/offerings 200\r\n2022-10-06 15:18:52.388247-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è No existing products cached, starting store products request for: [\"com.revenuecat.weekly_1.99.3_day_intro\", \"consumable.10_coins\", \"com.revenuecat.annual_39.99.2_week_intro\", \"com.revenuecat.monthly_4.99.1_week_intro\"]\r\n2022-10-06 15:18:52.388382-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Found an existing request for products: [\"com.revenuecat.monthly_4.99.1_week_intro\", \"com.revenuecat.annual_39.99.2_week_intro\", \"com.revenuecat.weekly_1.99.3_day_intro\", \"consumable.10_coins\"], appending to completion\r\n2022-10-06 15:18:52.388451-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è GetOfferingsOperation: Finished\r\n2022-10-06 15:18:52.388560-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: GET subscribers/$RCAnonymousID%3A6f630d50b8294288a2d0862629d766fb/offerings, 0 requests left in the queue\r\n2022-10-06 15:18:52.420210-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: üòª Store products request request received response\r\n2022-10-06 15:18:52.420358-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Store products request finished\r\n2022-10-06 15:18:52.421126-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-06 15:18:52.421353-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-06 15:18:52.496438-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-06 15:18:52.510974-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/A3576DC2-355E-45BA-B32C-D2C0A3811BB4/data/Containers/Data/Application/BFD385C4-52BC-414B-9C1C-44522ED1222F/StoreKit/receipt\r\n2022-10-06 15:18:52.511072-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:52.511181-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:52.511564-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:6f630d50b8294288a2d0862629d766fb\r\n2022-10-06 15:18:52.515448-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-06 15:18:52.516403-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-06 15:18:52.516763-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"oX91ewAAAAA=\",\r\n  \"sha1_hash\" : \"GsyNpUKQ89SonYyj\\/jpw8\\/N5nr8=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-06T22:18:52Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-06T22:18:52Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-06 15:18:52.516825-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-06 15:18:52.518059-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-06 15:18:52.960048-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-06 15:18:52.964274-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-06 15:18:52.964666-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-06 15:18:52.966476-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-06 15:18:52.966697-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-06 15:18:52.966973-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-06 15:18:52.967284-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-06 15:18:52.991334-0700 BackendIntegrationTestsHostApp[45464:7076973] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-06 15:18:53.015046-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/A3576DC2-355E-45BA-B32C-D2C0A3811BB4/data/Containers/Data/Application/BFD385C4-52BC-414B-9C1C-44522ED1222F/StoreKit/receipt\r\n2022-10-06 15:18:53.015174-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:53.015262-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:53.015419-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:6f630d50b8294288a2d0862629d766fb\r\n2022-10-06 15:18:53.015927-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-06 15:18:53.016558-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-06 15:18:53.016727-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"LP9LZQwAAAA=\",\r\n  \"sha1_hash\" : \"WdANBTWr7wYWh8RYEgmGebO8DR8=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-06T22:18:52Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-06T22:18:53Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-06 15:18:53.016783-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-06 15:18:53.017602-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-06 15:18:53.411689-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-06 15:18:53.413980-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-06 15:18:53.414147-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-06 15:18:53.414927-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-06 15:18:53.415505-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending CustomerInfo from cache.\r\n```\r\n</details>\r\n\r\nWith the fix, you can see transactions are now finished at the right\r\ntime:\r\n<details>\r\n  <summary>Open</summary>\r\n\r\n```\r\n2022-10-07 11:08:01.967843-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-07 11:08:02.123611-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-07 11:08:02.138918-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/F02A9A20-949B-4C9D-A01E-AB0CC7544F96/data/Containers/Data/Application/C52A5EFD-733F-46EC-84B7-734B6AF9D28C/StoreKit/receipt\r\n2022-10-07 11:08:02.139013-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.139095-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.139481-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:bd74b9d10f2c48eea1d741a32f5acb16\r\n2022-10-07 11:08:02.147220-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-07 11:08:02.148192-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-07 11:08:02.148552-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"\\/3nevQ0AAAA=\",\r\n  \"sha1_hash\" : \"\\/bAkxLQ6BPgUg3rR9jDR28dEfig=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-07T18:08:02Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-07T18:08:02Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-07 11:08:02.148604-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-07 11:08:02.149748-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-07 11:08:02.733225-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-07 11:08:02.734687-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-07 11:08:02.734802-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-07 11:08:02.735631-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-07 11:08:02.735700-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - INFO: üí∞ Finishing transaction '0' for product 'consumable.10_coins'\r\n2022-10-07 11:08:02.760613-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-07 11:08:02.760828-0700 BackendIntegrationTestsHostApp[45714:674590] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-07 11:08:02.761032-0700 BackendIntegrationTestsHostApp[45714:674590] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-07 11:08:02.820835-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-07 11:08:02.839184-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/F02A9A20-949B-4C9D-A01E-AB0CC7544F96/data/Containers/Data/Application/C52A5EFD-733F-46EC-84B7-734B6AF9D28C/StoreKit/receipt\r\n2022-10-07 11:08:02.839275-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.839348-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.839476-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:bd74b9d10f2c48eea1d741a32f5acb16\r\n2022-10-07 11:08:02.839911-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-07 11:08:02.840457-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-07 11:08:02.840603-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"fXr9\\/QYAAAA=\",\r\n  \"sha1_hash\" : \"zreYwGKGSaOEww1bsTRu8MylAas=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-07T18:08:02Z\",\r\n      \"transaction_id\" : \"1\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-07T18:08:02Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-07 11:08:02.840662-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-07 11:08:02.841268-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-07 11:08:03.313116-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-07 11:08:03.316115-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-07 11:08:03.316342-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-07 11:08:03.317444-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-07 11:08:03.317527-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - INFO: üí∞ Finishing transaction '1' for product 'consumable.10_coins'\r\n2022-10-07 11:08:03.342767-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n```\r\n\r\n</details>\r\n\r\n[TRIAGE-134]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-134?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ\r\n[TRIAGE-131]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-131?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ\r\n[TRIAGE-82]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-82?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ",
      "tree": {
        "sha": "dae0827ea97fee828527b3376fa9e376ca1dc41c",
        "url": "https://api.github.com/repos/RevenueCat/purchases-ios/git/trees/dae0827ea97fee828527b3376fa9e376ca1dc41c"
      },
      "url": "https://api.github.com/repos/RevenueCat/purchases-ios/git/commits/70365df383180d0225a8ff3df05444275bad3c4e",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjRdReCRBK7hj4Ov3rIwAAaVUIAIJwN5szHgKvrGTqJjjavjd6\nzIyoisUFh/Hl668OKpPKKRrYP9nth4QfS5ERt5X0AKPBU0HkIxITf5ZnDlBT132W\nt1bFernVIGueovuGM6/vCV1E4KBc5wj3loLGlumT5vpIU8w0+dsbzwJBtQHoh8qo\nG5kfxXPrih9b84o7I/TNSWXhU9k0zd2sypNTY8fKA6mbHjp/GdAN58plwCTKdm0N\n6yeS/NAuuh/jJ+AscJ+3gWQE5I4/alCk1IvNaz6XtLUi2oqmrld7bQJQjtXI1MEG\nj5xv9e9/Ot2i+EK13IDVvHlhpgtdc8MDX7IAsxeSDxUMxD2I6dWpBOKC5DNsRTE=\n=5t7W\n-----END PGP SIGNATURE-----\n",
        "payload": "tree dae0827ea97fee828527b3376fa9e376ca1dc41c\nparent 36dff6064e94222f50c1c7e23a79ab541407673a\nauthor NachoSoto <NachoSoto@users.noreply.github.com> 1665520734 -0700\ncommitter GitHub <noreply@github.com> 1665520734 -0700\n\nPurchasing: fixed consumable purchases by fixing transaction-finishing (#1965)\n\nFixes #1964, [TRIAGE-134], [TRIAGE-131], and possibly [TRIAGE-82].\r\n\r\nDepends on #1967, #1968.\r\n\r\n### Fixes:\r\n- For `SK2` purchases we were never finishing transactions. We are now.\r\n- For `SK1` purchases, transactions were finished _after_ the completion\r\nblock was invoked (and tests were very lenient checking that\r\n_eventually_ this happened). This could have lead to race conditions.\r\n- For SK2 only (at least in `SKTestSession`s), this fixes the ability to\r\npurchase multiple consumable purchases.\r\n\r\nThis is the log from the failing test using SK2:\r\n<details>\r\n  <summary>Open</summary>\r\n\r\n```\r\n2022-10-06 15:18:52.286813-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: GET /v1/subscribers/$RCAnonymousID:6f630d50b8294288a2d0862629d766fb/offerings\r\n2022-10-06 15:18:52.383594-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: GET /v1/subscribers/$RCAnonymousID:6f630d50b8294288a2d0862629d766fb/offerings 200\r\n2022-10-06 15:18:52.388247-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è No existing products cached, starting store products request for: [\"com.revenuecat.weekly_1.99.3_day_intro\", \"consumable.10_coins\", \"com.revenuecat.annual_39.99.2_week_intro\", \"com.revenuecat.monthly_4.99.1_week_intro\"]\r\n2022-10-06 15:18:52.388382-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Found an existing request for products: [\"com.revenuecat.monthly_4.99.1_week_intro\", \"com.revenuecat.annual_39.99.2_week_intro\", \"com.revenuecat.weekly_1.99.3_day_intro\", \"consumable.10_coins\"], appending to completion\r\n2022-10-06 15:18:52.388451-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è GetOfferingsOperation: Finished\r\n2022-10-06 15:18:52.388560-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: GET subscribers/$RCAnonymousID%3A6f630d50b8294288a2d0862629d766fb/offerings, 0 requests left in the queue\r\n2022-10-06 15:18:52.420210-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: üòª Store products request request received response\r\n2022-10-06 15:18:52.420358-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Store products request finished\r\n2022-10-06 15:18:52.421126-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-06 15:18:52.421353-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-06 15:18:52.496438-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-06 15:18:52.510974-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/A3576DC2-355E-45BA-B32C-D2C0A3811BB4/data/Containers/Data/Application/BFD385C4-52BC-414B-9C1C-44522ED1222F/StoreKit/receipt\r\n2022-10-06 15:18:52.511072-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:52.511181-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:52.511564-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:6f630d50b8294288a2d0862629d766fb\r\n2022-10-06 15:18:52.515448-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-06 15:18:52.516403-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-06 15:18:52.516763-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"oX91ewAAAAA=\",\r\n  \"sha1_hash\" : \"GsyNpUKQ89SonYyj\\/jpw8\\/N5nr8=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-06T22:18:52Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-06T22:18:52Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-06 15:18:52.516825-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-06 15:18:52.518059-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-06 15:18:52.960048-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-06 15:18:52.964274-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-06 15:18:52.964666-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-06 15:18:52.966476-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-06 15:18:52.966697-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-06 15:18:52.966973-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-06 15:18:52.967284-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-06 15:18:52.991334-0700 BackendIntegrationTestsHostApp[45464:7076973] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-06 15:18:53.015046-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/A3576DC2-355E-45BA-B32C-D2C0A3811BB4/data/Containers/Data/Application/BFD385C4-52BC-414B-9C1C-44522ED1222F/StoreKit/receipt\r\n2022-10-06 15:18:53.015174-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:53.015262-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:53.015419-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:6f630d50b8294288a2d0862629d766fb\r\n2022-10-06 15:18:53.015927-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-06 15:18:53.016558-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-06 15:18:53.016727-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"LP9LZQwAAAA=\",\r\n  \"sha1_hash\" : \"WdANBTWr7wYWh8RYEgmGebO8DR8=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-06T22:18:52Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-06T22:18:53Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-06 15:18:53.016783-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-06 15:18:53.017602-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-06 15:18:53.411689-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-06 15:18:53.413980-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-06 15:18:53.414147-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-06 15:18:53.414927-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-06 15:18:53.415505-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending CustomerInfo from cache.\r\n```\r\n</details>\r\n\r\nWith the fix, you can see transactions are now finished at the right\r\ntime:\r\n<details>\r\n  <summary>Open</summary>\r\n\r\n```\r\n2022-10-07 11:08:01.967843-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-07 11:08:02.123611-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-07 11:08:02.138918-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/F02A9A20-949B-4C9D-A01E-AB0CC7544F96/data/Containers/Data/Application/C52A5EFD-733F-46EC-84B7-734B6AF9D28C/StoreKit/receipt\r\n2022-10-07 11:08:02.139013-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.139095-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.139481-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:bd74b9d10f2c48eea1d741a32f5acb16\r\n2022-10-07 11:08:02.147220-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-07 11:08:02.148192-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-07 11:08:02.148552-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"\\/3nevQ0AAAA=\",\r\n  \"sha1_hash\" : \"\\/bAkxLQ6BPgUg3rR9jDR28dEfig=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-07T18:08:02Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-07T18:08:02Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-07 11:08:02.148604-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-07 11:08:02.149748-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-07 11:08:02.733225-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-07 11:08:02.734687-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-07 11:08:02.734802-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-07 11:08:02.735631-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-07 11:08:02.735700-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - INFO: üí∞ Finishing transaction '0' for product 'consumable.10_coins'\r\n2022-10-07 11:08:02.760613-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-07 11:08:02.760828-0700 BackendIntegrationTestsHostApp[45714:674590] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-07 11:08:02.761032-0700 BackendIntegrationTestsHostApp[45714:674590] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-07 11:08:02.820835-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-07 11:08:02.839184-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/F02A9A20-949B-4C9D-A01E-AB0CC7544F96/data/Containers/Data/Application/C52A5EFD-733F-46EC-84B7-734B6AF9D28C/StoreKit/receipt\r\n2022-10-07 11:08:02.839275-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.839348-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.839476-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:bd74b9d10f2c48eea1d741a32f5acb16\r\n2022-10-07 11:08:02.839911-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-07 11:08:02.840457-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-07 11:08:02.840603-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"fXr9\\/QYAAAA=\",\r\n  \"sha1_hash\" : \"zreYwGKGSaOEww1bsTRu8MylAas=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-07T18:08:02Z\",\r\n      \"transaction_id\" : \"1\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-07T18:08:02Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-07 11:08:02.840662-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-07 11:08:02.841268-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-07 11:08:03.313116-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-07 11:08:03.316115-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-07 11:08:03.316342-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-07 11:08:03.317444-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-07 11:08:03.317527-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - INFO: üí∞ Finishing transaction '1' for product 'consumable.10_coins'\r\n2022-10-07 11:08:03.342767-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n```\r\n\r\n</details>\r\n\r\n[TRIAGE-134]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-134?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ\r\n[TRIAGE-131]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-131?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ\r\n[TRIAGE-82]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-82?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ"
      }
    },
    "url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/70365df383180d0225a8ff3df05444275bad3c4e",
    "html_url": "https://github.com/RevenueCat/purchases-ios/commit/70365df383180d0225a8ff3df05444275bad3c4e",
    "comments_url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/70365df383180d0225a8ff3df05444275bad3c4e/comments",
    "author": {
      "login": "NachoSoto",
      "id": 685609,
      "node_id": "MDQ6VXNlcjY4NTYwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/685609?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NachoSoto",
      "html_url": "https://github.com/NachoSoto",
      "followers_url": "https://api.github.com/users/NachoSoto/followers",
      "following_url": "https://api.github.com/users/NachoSoto/following{/other_user}",
      "gists_url": "https://api.github.com/users/NachoSoto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NachoSoto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NachoSoto/subscriptions",
      "organizations_url": "https://api.github.com/users/NachoSoto/orgs",
      "repos_url": "https://api.github.com/users/NachoSoto/repos",
      "events_url": "https://api.github.com/users/NachoSoto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NachoSoto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "web-flow",
      "id": 19864447,
      "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/web-flow",
      "html_url": "https://github.com/web-flow",
      "followers_url": "https://api.github.com/users/web-flow/followers",
      "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
      "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
      "organizations_url": "https://api.github.com/users/web-flow/orgs",
      "repos_url": "https://api.github.com/users/web-flow/repos",
      "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/web-flow/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "36dff6064e94222f50c1c7e23a79ab541407673a",
        "url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/36dff6064e94222f50c1c7e23a79ab541407673a",
        "html_url": "https://github.com/RevenueCat/purchases-ios/commit/36dff6064e94222f50c1c7e23a79ab541407673a"
      }
    ]
  },
  "merge_base_commit": {
    "sha": "70365df383180d0225a8ff3df05444275bad3c4e",
    "node_id": "C_kwDOBnB8hdoAKDcwMzY1ZGYzODMxODBkMDIyNWE4ZmYzZGYwNTQ0NDI3NWJhZDNjNGU",
    "commit": {
      "author": {
        "name": "NachoSoto",
        "email": "NachoSoto@users.noreply.github.com",
        "date": "2022-10-11T20:38:54Z"
      },
      "committer": {
        "name": "GitHub",
        "email": "noreply@github.com",
        "date": "2022-10-11T20:38:54Z"
      },
      "message": "Purchasing: fixed consumable purchases by fixing transaction-finishing (#1965)\n\nFixes #1964, [TRIAGE-134], [TRIAGE-131], and possibly [TRIAGE-82].\r\n\r\nDepends on #1967, #1968.\r\n\r\n### Fixes:\r\n- For `SK2` purchases we were never finishing transactions. We are now.\r\n- For `SK1` purchases, transactions were finished _after_ the completion\r\nblock was invoked (and tests were very lenient checking that\r\n_eventually_ this happened). This could have lead to race conditions.\r\n- For SK2 only (at least in `SKTestSession`s), this fixes the ability to\r\npurchase multiple consumable purchases.\r\n\r\nThis is the log from the failing test using SK2:\r\n<details>\r\n  <summary>Open</summary>\r\n\r\n```\r\n2022-10-06 15:18:52.286813-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: GET /v1/subscribers/$RCAnonymousID:6f630d50b8294288a2d0862629d766fb/offerings\r\n2022-10-06 15:18:52.383594-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: GET /v1/subscribers/$RCAnonymousID:6f630d50b8294288a2d0862629d766fb/offerings 200\r\n2022-10-06 15:18:52.388247-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è No existing products cached, starting store products request for: [\"com.revenuecat.weekly_1.99.3_day_intro\", \"consumable.10_coins\", \"com.revenuecat.annual_39.99.2_week_intro\", \"com.revenuecat.monthly_4.99.1_week_intro\"]\r\n2022-10-06 15:18:52.388382-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Found an existing request for products: [\"com.revenuecat.monthly_4.99.1_week_intro\", \"com.revenuecat.annual_39.99.2_week_intro\", \"com.revenuecat.weekly_1.99.3_day_intro\", \"consumable.10_coins\"], appending to completion\r\n2022-10-06 15:18:52.388451-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è GetOfferingsOperation: Finished\r\n2022-10-06 15:18:52.388560-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: GET subscribers/$RCAnonymousID%3A6f630d50b8294288a2d0862629d766fb/offerings, 0 requests left in the queue\r\n2022-10-06 15:18:52.420210-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: üòª Store products request request received response\r\n2022-10-06 15:18:52.420358-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Store products request finished\r\n2022-10-06 15:18:52.421126-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-06 15:18:52.421353-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-06 15:18:52.496438-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-06 15:18:52.510974-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/A3576DC2-355E-45BA-B32C-D2C0A3811BB4/data/Containers/Data/Application/BFD385C4-52BC-414B-9C1C-44522ED1222F/StoreKit/receipt\r\n2022-10-06 15:18:52.511072-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:52.511181-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:52.511564-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:6f630d50b8294288a2d0862629d766fb\r\n2022-10-06 15:18:52.515448-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-06 15:18:52.516403-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-06 15:18:52.516763-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"oX91ewAAAAA=\",\r\n  \"sha1_hash\" : \"GsyNpUKQ89SonYyj\\/jpw8\\/N5nr8=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-06T22:18:52Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-06T22:18:52Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-06 15:18:52.516825-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-06 15:18:52.518059-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-06 15:18:52.960048-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-06 15:18:52.964274-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-06 15:18:52.964666-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-06 15:18:52.966476-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-06 15:18:52.966697-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-06 15:18:52.966973-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-06 15:18:52.967284-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-06 15:18:52.991334-0700 BackendIntegrationTestsHostApp[45464:7076973] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-06 15:18:53.015046-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/A3576DC2-355E-45BA-B32C-D2C0A3811BB4/data/Containers/Data/Application/BFD385C4-52BC-414B-9C1C-44522ED1222F/StoreKit/receipt\r\n2022-10-06 15:18:53.015174-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:53.015262-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:53.015419-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:6f630d50b8294288a2d0862629d766fb\r\n2022-10-06 15:18:53.015927-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-06 15:18:53.016558-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-06 15:18:53.016727-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"LP9LZQwAAAA=\",\r\n  \"sha1_hash\" : \"WdANBTWr7wYWh8RYEgmGebO8DR8=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-06T22:18:52Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-06T22:18:53Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-06 15:18:53.016783-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-06 15:18:53.017602-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-06 15:18:53.411689-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-06 15:18:53.413980-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-06 15:18:53.414147-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-06 15:18:53.414927-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-06 15:18:53.415505-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending CustomerInfo from cache.\r\n```\r\n</details>\r\n\r\nWith the fix, you can see transactions are now finished at the right\r\ntime:\r\n<details>\r\n  <summary>Open</summary>\r\n\r\n```\r\n2022-10-07 11:08:01.967843-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-07 11:08:02.123611-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-07 11:08:02.138918-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/F02A9A20-949B-4C9D-A01E-AB0CC7544F96/data/Containers/Data/Application/C52A5EFD-733F-46EC-84B7-734B6AF9D28C/StoreKit/receipt\r\n2022-10-07 11:08:02.139013-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.139095-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.139481-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:bd74b9d10f2c48eea1d741a32f5acb16\r\n2022-10-07 11:08:02.147220-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-07 11:08:02.148192-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-07 11:08:02.148552-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"\\/3nevQ0AAAA=\",\r\n  \"sha1_hash\" : \"\\/bAkxLQ6BPgUg3rR9jDR28dEfig=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-07T18:08:02Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-07T18:08:02Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-07 11:08:02.148604-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-07 11:08:02.149748-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-07 11:08:02.733225-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-07 11:08:02.734687-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-07 11:08:02.734802-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-07 11:08:02.735631-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-07 11:08:02.735700-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - INFO: üí∞ Finishing transaction '0' for product 'consumable.10_coins'\r\n2022-10-07 11:08:02.760613-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-07 11:08:02.760828-0700 BackendIntegrationTestsHostApp[45714:674590] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-07 11:08:02.761032-0700 BackendIntegrationTestsHostApp[45714:674590] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-07 11:08:02.820835-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-07 11:08:02.839184-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/F02A9A20-949B-4C9D-A01E-AB0CC7544F96/data/Containers/Data/Application/C52A5EFD-733F-46EC-84B7-734B6AF9D28C/StoreKit/receipt\r\n2022-10-07 11:08:02.839275-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.839348-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.839476-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:bd74b9d10f2c48eea1d741a32f5acb16\r\n2022-10-07 11:08:02.839911-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-07 11:08:02.840457-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-07 11:08:02.840603-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"fXr9\\/QYAAAA=\",\r\n  \"sha1_hash\" : \"zreYwGKGSaOEww1bsTRu8MylAas=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-07T18:08:02Z\",\r\n      \"transaction_id\" : \"1\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-07T18:08:02Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-07 11:08:02.840662-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-07 11:08:02.841268-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-07 11:08:03.313116-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-07 11:08:03.316115-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-07 11:08:03.316342-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-07 11:08:03.317444-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-07 11:08:03.317527-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - INFO: üí∞ Finishing transaction '1' for product 'consumable.10_coins'\r\n2022-10-07 11:08:03.342767-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n```\r\n\r\n</details>\r\n\r\n[TRIAGE-134]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-134?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ\r\n[TRIAGE-131]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-131?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ\r\n[TRIAGE-82]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-82?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ",
      "tree": {
        "sha": "dae0827ea97fee828527b3376fa9e376ca1dc41c",
        "url": "https://api.github.com/repos/RevenueCat/purchases-ios/git/trees/dae0827ea97fee828527b3376fa9e376ca1dc41c"
      },
      "url": "https://api.github.com/repos/RevenueCat/purchases-ios/git/commits/70365df383180d0225a8ff3df05444275bad3c4e",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjRdReCRBK7hj4Ov3rIwAAaVUIAIJwN5szHgKvrGTqJjjavjd6\nzIyoisUFh/Hl668OKpPKKRrYP9nth4QfS5ERt5X0AKPBU0HkIxITf5ZnDlBT132W\nt1bFernVIGueovuGM6/vCV1E4KBc5wj3loLGlumT5vpIU8w0+dsbzwJBtQHoh8qo\nG5kfxXPrih9b84o7I/TNSWXhU9k0zd2sypNTY8fKA6mbHjp/GdAN58plwCTKdm0N\n6yeS/NAuuh/jJ+AscJ+3gWQE5I4/alCk1IvNaz6XtLUi2oqmrld7bQJQjtXI1MEG\nj5xv9e9/Ot2i+EK13IDVvHlhpgtdc8MDX7IAsxeSDxUMxD2I6dWpBOKC5DNsRTE=\n=5t7W\n-----END PGP SIGNATURE-----\n",
        "payload": "tree dae0827ea97fee828527b3376fa9e376ca1dc41c\nparent 36dff6064e94222f50c1c7e23a79ab541407673a\nauthor NachoSoto <NachoSoto@users.noreply.github.com> 1665520734 -0700\ncommitter GitHub <noreply@github.com> 1665520734 -0700\n\nPurchasing: fixed consumable purchases by fixing transaction-finishing (#1965)\n\nFixes #1964, [TRIAGE-134], [TRIAGE-131], and possibly [TRIAGE-82].\r\n\r\nDepends on #1967, #1968.\r\n\r\n### Fixes:\r\n- For `SK2` purchases we were never finishing transactions. We are now.\r\n- For `SK1` purchases, transactions were finished _after_ the completion\r\nblock was invoked (and tests were very lenient checking that\r\n_eventually_ this happened). This could have lead to race conditions.\r\n- For SK2 only (at least in `SKTestSession`s), this fixes the ability to\r\npurchase multiple consumable purchases.\r\n\r\nThis is the log from the failing test using SK2:\r\n<details>\r\n  <summary>Open</summary>\r\n\r\n```\r\n2022-10-06 15:18:52.286813-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: GET /v1/subscribers/$RCAnonymousID:6f630d50b8294288a2d0862629d766fb/offerings\r\n2022-10-06 15:18:52.383594-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: GET /v1/subscribers/$RCAnonymousID:6f630d50b8294288a2d0862629d766fb/offerings 200\r\n2022-10-06 15:18:52.388247-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è No existing products cached, starting store products request for: [\"com.revenuecat.weekly_1.99.3_day_intro\", \"consumable.10_coins\", \"com.revenuecat.annual_39.99.2_week_intro\", \"com.revenuecat.monthly_4.99.1_week_intro\"]\r\n2022-10-06 15:18:52.388382-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Found an existing request for products: [\"com.revenuecat.monthly_4.99.1_week_intro\", \"com.revenuecat.annual_39.99.2_week_intro\", \"com.revenuecat.weekly_1.99.3_day_intro\", \"consumable.10_coins\"], appending to completion\r\n2022-10-06 15:18:52.388451-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è GetOfferingsOperation: Finished\r\n2022-10-06 15:18:52.388560-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: GET subscribers/$RCAnonymousID%3A6f630d50b8294288a2d0862629d766fb/offerings, 0 requests left in the queue\r\n2022-10-06 15:18:52.420210-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: üòª Store products request request received response\r\n2022-10-06 15:18:52.420358-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Store products request finished\r\n2022-10-06 15:18:52.421126-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-06 15:18:52.421353-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-06 15:18:52.496438-0700 BackendIntegrationTestsHostApp[45464:7076968] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-06 15:18:52.510974-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/A3576DC2-355E-45BA-B32C-D2C0A3811BB4/data/Containers/Data/Application/BFD385C4-52BC-414B-9C1C-44522ED1222F/StoreKit/receipt\r\n2022-10-06 15:18:52.511072-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:52.511181-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:52.511564-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:6f630d50b8294288a2d0862629d766fb\r\n2022-10-06 15:18:52.515448-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-06 15:18:52.516403-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-06 15:18:52.516763-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"oX91ewAAAAA=\",\r\n  \"sha1_hash\" : \"GsyNpUKQ89SonYyj\\/jpw8\\/N5nr8=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-06T22:18:52Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-06T22:18:52Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-06 15:18:52.516825-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-06 15:18:52.518059-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-06 15:18:52.960048-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-06 15:18:52.964274-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-06 15:18:52.964666-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-06 15:18:52.966476-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-06 15:18:52.966697-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-06 15:18:52.966973-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-06 15:18:52.967284-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-06 15:18:52.991334-0700 BackendIntegrationTestsHostApp[45464:7076973] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-06 15:18:53.015046-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/A3576DC2-355E-45BA-B32C-D2C0A3811BB4/data/Containers/Data/Application/BFD385C4-52BC-414B-9C1C-44522ED1222F/StoreKit/receipt\r\n2022-10-06 15:18:53.015174-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:53.015262-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-06 15:18:53.015419-0700 BackendIntegrationTestsHostApp[45464:7076903] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:6f630d50b8294288a2d0862629d766fb\r\n2022-10-06 15:18:53.015927-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-06 15:18:53.016558-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-06 15:18:53.016727-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"LP9LZQwAAAA=\",\r\n  \"sha1_hash\" : \"WdANBTWr7wYWh8RYEgmGebO8DR8=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-06T22:18:52Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-06T22:18:53Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-06 15:18:53.016783-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-06 15:18:53.017602-0700 BackendIntegrationTestsHostApp[45464:7076966] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-06 15:18:53.411689-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-06 15:18:53.413980-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-06 15:18:53.414147-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-06 15:18:53.414927-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-06 15:18:53.415505-0700 BackendIntegrationTestsHostApp[45464:7076978] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending CustomerInfo from cache.\r\n```\r\n</details>\r\n\r\nWith the fix, you can see transactions are now finished at the right\r\ntime:\r\n<details>\r\n  <summary>Open</summary>\r\n\r\n```\r\n2022-10-07 11:08:01.967843-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-07 11:08:02.123611-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-07 11:08:02.138918-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/F02A9A20-949B-4C9D-A01E-AB0CC7544F96/data/Containers/Data/Application/C52A5EFD-733F-46EC-84B7-734B6AF9D28C/StoreKit/receipt\r\n2022-10-07 11:08:02.139013-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.139095-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.139481-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:bd74b9d10f2c48eea1d741a32f5acb16\r\n2022-10-07 11:08:02.147220-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-07 11:08:02.148192-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-07 11:08:02.148552-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"\\/3nevQ0AAAA=\",\r\n  \"sha1_hash\" : \"\\/bAkxLQ6BPgUg3rR9jDR28dEfig=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-07T18:08:02Z\",\r\n      \"transaction_id\" : \"0\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-07T18:08:02Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-07 11:08:02.148604-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-07 11:08:02.149748-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-07 11:08:02.733225-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-07 11:08:02.734687-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-07 11:08:02.734802-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-07 11:08:02.735631-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-07 11:08:02.735700-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - INFO: üí∞ Finishing transaction '0' for product 'consumable.10_coins'\r\n2022-10-07 11:08:02.760613-0700 BackendIntegrationTestsHostApp[45714:674592] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n2022-10-07 11:08:02.760828-0700 BackendIntegrationTestsHostApp[45714:674590] [Purchases] - DEBUG: ‚ÑπÔ∏è Vending Offerings from cache\r\n2022-10-07 11:08:02.761032-0700 BackendIntegrationTestsHostApp[45714:674590] [Purchases] - INFO: üí∞ Purchasing Product 'consumable.10_coins' from package in Offering 'coins'\r\n2022-10-07 11:08:02.820835-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è Force refreshing the receipt to get latest transactions from Apple.\r\n2022-10-07 11:08:02.839184-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Loaded receipt from url file:///Users/nachosoto/Library/Developer/CoreSimulator/Devices/F02A9A20-949B-4C9D-A01E-AB0CC7544F96/data/Containers/Data/Application/C52A5EFD-733F-46EC-84B7-734B6AF9D28C/StoreKit/receipt\r\n2022-10-07 11:08:02.839275-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.839348-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Skipping products request because products were already cached. products: [\"consumable.10_coins\"]\r\n2022-10-07 11:08:02.839476-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Found 0 unsynced attributes for App User ID: $RCAnonymousID:bd74b9d10f2c48eea1d741a32f5acb16\r\n2022-10-07 11:08:02.839911-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Started\r\n2022-10-07 11:08:02.840457-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - INFO: ‚ÑπÔ∏è Receipt parsed successfully\r\n2022-10-07 11:08:02.840603-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Posting receipt: {\r\n  \"opaque_value\" : \"fXr9\\/QYAAAA=\",\r\n  \"sha1_hash\" : \"zreYwGKGSaOEww1bsTRu8MylAas=\",\r\n  \"bundle_id\" : \"com.revenuecat.StoreKitTestApp\",\r\n  \"in_app_purchases\" : [\r\n    {\r\n      \"quantity\" : 1,\r\n      \"product_id\" : \"consumable.10_coins\",\r\n      \"purchase_date\" : \"2022-10-07T18:08:02Z\",\r\n      \"transaction_id\" : \"1\"\r\n    }\r\n  ],\r\n  \"application_version\" : \"1\",\r\n  \"creation_date\" : \"2022-10-07T18:08:02Z\",\r\n  \"expiration_date\" : \"4001-01-01T00:00:00Z\"\r\n}\r\n2022-10-07 11:08:02.840662-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è There are no requests currently running, starting request POST receipts\r\n2022-10-07 11:08:02.841268-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è API request started: POST /v1/receipts\r\n2022-10-07 11:08:03.313116-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è API request completed: POST /v1/receipts 200\r\n2022-10-07 11:08:03.316115-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è PostReceiptDataOperation: Finished\r\n2022-10-07 11:08:03.316342-0700 BackendIntegrationTestsHostApp[45714:674589] [Purchases] - DEBUG: ‚ÑπÔ∏è Serial request done: POST receipts, 0 requests left in the queue\r\n2022-10-07 11:08:03.317444-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - DEBUG: ‚ÑπÔ∏è Sending updated CustomerInfo to delegate.\r\n2022-10-07 11:08:03.317527-0700 BackendIntegrationTestsHostApp[45714:674399] [Purchases] - INFO: üí∞ Finishing transaction '1' for product 'consumable.10_coins'\r\n2022-10-07 11:08:03.342767-0700 BackendIntegrationTestsHostApp[45714:674602] [Purchases] - INFO: üòªüí∞ Purchased product - 'consumable.10_coins'\r\n```\r\n\r\n</details>\r\n\r\n[TRIAGE-134]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-134?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ\r\n[TRIAGE-131]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-131?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ\r\n[TRIAGE-82]:\r\nhttps://revenuecats.atlassian.net/browse/TRIAGE-82?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ"
      }
    },
    "url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/70365df383180d0225a8ff3df05444275bad3c4e",
    "html_url": "https://github.com/RevenueCat/purchases-ios/commit/70365df383180d0225a8ff3df05444275bad3c4e",
    "comments_url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/70365df383180d0225a8ff3df05444275bad3c4e/comments",
    "author": {
      "login": "NachoSoto",
      "id": 685609,
      "node_id": "MDQ6VXNlcjY4NTYwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/685609?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NachoSoto",
      "html_url": "https://github.com/NachoSoto",
      "followers_url": "https://api.github.com/users/NachoSoto/followers",
      "following_url": "https://api.github.com/users/NachoSoto/following{/other_user}",
      "gists_url": "https://api.github.com/users/NachoSoto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NachoSoto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NachoSoto/subscriptions",
      "organizations_url": "https://api.github.com/users/NachoSoto/orgs",
      "repos_url": "https://api.github.com/users/NachoSoto/repos",
      "events_url": "https://api.github.com/users/NachoSoto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NachoSoto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "web-flow",
      "id": 19864447,
      "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/web-flow",
      "html_url": "https://github.com/web-flow",
      "followers_url": "https://api.github.com/users/web-flow/followers",
      "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
      "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
      "organizations_url": "https://api.github.com/users/web-flow/orgs",
      "repos_url": "https://api.github.com/users/web-flow/repos",
      "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/web-flow/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "36dff6064e94222f50c1c7e23a79ab541407673a",
        "url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/36dff6064e94222f50c1c7e23a79ab541407673a",
        "html_url": "https://github.com/RevenueCat/purchases-ios/commit/36dff6064e94222f50c1c7e23a79ab541407673a"
      }
    ]
  },
  "status": "ahead",
  "ahead_by": 1,
  "behind_by": 0,
  "total_commits": 1,
  "commits": [
    {
      "sha": "4ceaceb20e700b92197daf8904f5c4e226625d8a",
      "node_id": "C_kwDOBnB8hdoAKDRjZWFjZWIyMGU3MDBiOTIxOTdkYWY4OTA0ZjVjNGUyMjY2MjVkOGE",
      "commit": {
        "author": {
          "name": "Miguel Jos√© Carranza Guisado",
          "email": "miguel@miguelcarranza.es",
          "date": "2022-10-11T21:59:31Z"
        },
        "committer": {
          "name": "GitHub",
          "email": "noreply@github.com",
          "date": "2022-10-11T21:59:31Z"
        },
        "message": "Updating great support link",
        "tree": {
          "sha": "ff87c48a652cbe977d066f5883754c54ab0ea033",
          "url": "https://api.github.com/repos/RevenueCat/purchases-ios/git/trees/ff87c48a652cbe977d066f5883754c54ab0ea033"
        },
        "url": "https://api.github.com/repos/RevenueCat/purchases-ios/git/commits/4ceaceb20e700b92197daf8904f5c4e226625d8a",
        "comment_count": 0,
        "verification": {
          "verified": true,
          "reason": "valid",
          "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjRedDCRBK7hj4Ov3rIwAAEw0IAKE7uY3gSTzWCBcudTpr3Lf1\naBjWH7bAFZ9yfGIEdQ27jBEu0ZqF2Cgo5elOloPdUaZVTljZnuGrjQPsykobMtid\na7o0+/7+O9QRO4Z9O8VjZ19yOFNwSTPvxtt42eb+NVvVZMdN9YLoiRqp+B/NuAON\n5eGZ6+Ddh2AQvWN4QRgYTeLMciy9dp2/VfGEKYlQl30nNXoxz71/Hn9+txZ8SCRA\npDwtPoT0ZVRqRyy2qYQg2l/JcE3EZFN3VAVdOUSOymPBOLuHacrV5RIYopzv96Z3\nu7SWu28YBPQasv5aiocRTcRFn88CRhS5NpT6NvdTXU74SEcjEBjNXhFAffc77sc=\n=/J2q\n-----END PGP SIGNATURE-----\n",
          "payload": "tree ff87c48a652cbe977d066f5883754c54ab0ea033\nparent 70365df383180d0225a8ff3df05444275bad3c4e\nauthor Miguel Jos√© Carranza Guisado <miguel@miguelcarranza.es> 1665525571 -0700\ncommitter GitHub <noreply@github.com> 1665525571 -0700\n\nUpdating great support link"
        }
      },
      "url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/4ceaceb20e700b92197daf8904f5c4e226625d8a",
      "html_url": "https://github.com/RevenueCat/purchases-ios/commit/4ceaceb20e700b92197daf8904f5c4e226625d8a",
      "comments_url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/4ceaceb20e700b92197daf8904f5c4e226625d8a/comments",
      "author": {
        "login": "MiguelCarranza",
        "id": 1735203,
        "node_id": "MDQ6VXNlcjE3MzUyMDM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1735203?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MiguelCarranza",
        "html_url": "https://github.com/MiguelCarranza",
        "followers_url": "https://api.github.com/users/MiguelCarranza/followers",
        "following_url": "https://api.github.com/users/MiguelCarranza/following{/other_user}",
        "gists_url": "https://api.github.com/users/MiguelCarranza/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/MiguelCarranza/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/MiguelCarranza/subscriptions",
        "organizations_url": "https://api.github.com/users/MiguelCarranza/orgs",
        "repos_url": "https://api.github.com/users/MiguelCarranza/repos",
        "events_url": "https://api.github.com/users/MiguelCarranza/events{/privacy}",
        "received_events_url": "https://api.github.com/users/MiguelCarranza/received_events",
        "type": "User",
        "site_admin": false
      },
      "committer": {
        "login": "web-flow",
        "id": 19864447,
        "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
        "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/web-flow",
        "html_url": "https://github.com/web-flow",
        "followers_url": "https://api.github.com/users/web-flow/followers",
        "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
        "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
        "organizations_url": "https://api.github.com/users/web-flow/orgs",
        "repos_url": "https://api.github.com/users/web-flow/repos",
        "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
        "received_events_url": "https://api.github.com/users/web-flow/received_events",
        "type": "User",
        "site_admin": false
      },
      "parents": [
        {
          "sha": "70365df383180d0225a8ff3df05444275bad3c4e",
          "url": "https://api.github.com/repos/RevenueCat/purchases-ios/commits/70365df383180d0225a8ff3df05444275bad3c4e",
          "html_url": "https://github.com/RevenueCat/purchases-ios/commit/70365df383180d0225a8ff3df05444275bad3c4e"
        }
      ]
    }
  ],
  "files": [
    {
      "sha": "81d7ead4eeeb9d9e5a65171ef8ee6384184424a1",
      "filename": "README.md",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/RevenueCat/purchases-ios/blob/4ceaceb20e700b92197daf8904f5c4e226625d8a/README.md",
      "raw_url": "https://github.com/RevenueCat/purchases-ios/raw/4ceaceb20e700b92197daf8904f5c4e226625d8a/README.md",
      "contents_url": "https://api.github.com/repos/RevenueCat/purchases-ios/contents/README.md?ref=4ceaceb20e700b92197daf8904f5c4e226625d8a",
      "patch": "@@ -38,7 +38,7 @@ Sign up to [get started for free](https://app.revenuecat.com/signup).\n üìù | [Online documentation](https://docs.revenuecat.com/docs) and [SDK Reference](http://revenuecat.github.io/purchases-ios-docs/) up to date\n üîÄ | [Integrations](https://www.revenuecat.com/integrations) - over a dozen integrations to easily send purchase data where you need it\n üíØ | Well maintained - [frequent releases](https://github.com/RevenueCat/purchases-ios/releases)\n-üìÆ | Great support - [Help Center](https://community.revenuecat.com)\n+üìÆ | Great support - [Contact us](https://revenuecat.com/support)\n \n ## Getting Started\n For more detailed information, you can view our complete documentation at [docs.revenuecat.com](https://docs.revenuecat.com/docs)."
    }
  ]
}